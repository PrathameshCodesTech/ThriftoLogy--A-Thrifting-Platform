{% extends 'base.html' %}
{% load static %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'css/clothesGallery.css' %}">
{% endblock %}


{% block herosection %}


<main class="pt-24 max-w-7xl mx-auto px-4">
    <!-- Cart Dropdown -->
    <div id="cartDropdown"
        class="fixed top-40 right-0 bg-white h-[21rem] w-full sm:w-96 transform opacity-0 -translate-y-full transition-transform duration-300 ease-in-out z-30">
        <div>
            <div class="">
                <div class="flex justify-between items-center px-5">
                    <div class="flex gap-1">
                        <i class="ri-check-line text-sm"></i>
                        <p class="text-sm">Items added to your cart</p>
                    </div>
                    <div id="crossBtn">
                        <i class="ri-close-line font-light text-3xl cursor-pointer"></i>
                    </div>
                </div>
                <div class="flex px-5">
                    <div class="h-32 w-24 pt-2">
                        <img id="dropdownImage" src="" alt="">
                    </div>
                    <div class="ms-2 w-44 h-32 text-wrap pt-1">
                        <h1 id="dropdownName" class="text-sm"></h1>
                    </div>
                </div>
                <div class="px-5 mt-5 flex flex-col gap-2">
                    <a href="{% url 'Add_Cart' %}"><button class="border-black border-2 w-full h-12">View
                            Cart</button></a>
                    <button class="w-full h-12 bg-black text-white">Check out</button>
                </div>
                <div>
                    <a href="{% url 'Show_Cart' %}">
                        <h3 class="text-center text-sm mt-3 underline">Continue Shopping</h3>
                    </a>
                </div>
            </div>
        </div>
    </div>



    <!--  -->
    <main class="pt-24 max-w-7xl mx-auto px-4">
        <!-- Product Section -->
        <div class="grid md:grid-cols-2 gap-8 items-start">
            <!-- Product Image with controlled size -->
            <div class="w-600 h-600 max-w-lg mx-auto">
                <img src="{{ product.image.url }}" alt="{{ product.name }}"
                    class="w-full h-full object-cover rounded-lg shadow-lg">
            </div>

            <!-- Product Details -->
            <div class="space-y-6">
                <h2 class="text-lg font-bold my-2">{{ product.name }}</h2>
                <h2 class="text-lg font-bold my-2">Classic vintage denim jacket featuring distressed details and
                    authentic
                    {{ product.brand }}</h2>
                <p class="text-red-500 font-bold">₹ {{ product.selling_price }}</p>
                <p class="text-gray-500 line-through">₹ {{ product.discounted_price }}</p>

                <p class="text-gray-600">Classic vintage denim jacket featuring distressed details and authentic
                    wear patterns. Perfect for casual everyday wear with its timeless design and comfortable fit.
                    Lorem ipsum dolor sit amet consectetur adipisicing elit. Sint consequuntur ullam ut culpa
                    eligendi nam vel aut dolorem excepturi provident consequatur neque nemo, beatae dolores, commodi
                    in enim modi placeat quidem tempore fugit exercitationem explicabo. Consequuntur debitis autem
                    consectetur molestiae, assumenda nulla dolorem numquam natus?</p>

                <!-- Size Selection -->
                <div>
                    <h3 class="font-semibold mb-2">Select Size</h3>
                    <div class="flex space-x-2">
                        <button class="px-4 py-2 border rounded hover:bg-gray-100">S</button>
                        <button class="px-4 py-2 border rounded bg-black text-white">M</button>
                        <button class="px-4 py-2 border rounded hover:bg-gray-100">L</button>
                        <button class="px-4 py-2 border rounded hover:bg-gray-100">XL</button>
                    </div>
                </div>

                <!-- Add to Cart Button -->
                <button class="add-to-cart">Add to Cart</button>
                <button class="add-to-cart">Wish List</button>

                <div class="border-t pt-6 space-y-4">
                    <div>
                        <h3 class="font-semibold">Material</h3>
                        <p class="text-gray-600">100% Cotton Denim</p>
                    </div>
                    <div>
                        <h3 class="font-semibold">Condition</h3>
                        <p class="text-gray-600">Excellent vintage condition</p>
                    </div>
                    <div>
                        <h3 class="font-semibold">Era</h3>
                        <p class="text-gray-600">1990s</p>
                    </div>
                </div>
            </div>
        </div>

        {% endblock %}

        {% block product-grid %}


        <section class="mt-16">
            <h2 class="text-2xl font-bold mb-6">You May Also Like</h2>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                {% for similar_product in similar_products %}
                <div class="group">
                    <div class="aspect-w-1 aspect-h-1 mb-4">
                        <img src="{{ similar_product.image.url }}" alt="{{ similar_product.name }}"
                            class="w-full h-full object-cover rounded-lg">
                    </div>
                    <h3 class="font-semibold">{{ similar_product.name }}</h3>
                    <p class="text-red-500">{{ similar_product.selling_price }}</p>
                    <!-- Place the button inside the loop -->
                    <a href="{% url 'Detail' pk=similar_product.id %}">
                        <button class="bg-black text-white px-4 py-2 rounded hover:bg-gray-800">View More</button>
                    </a>
                </div>
                {% endfor %}
            </div>
        </section>



        {% endblock %}

        {% block extra_js %}

        <script>

            document.querySelectorAll("#productDetail").forEach(product => {
                const increaseBtn = product.querySelector(".increase")
                const decreaseBtn = product.querySelector(".decrease")
                const quantity = product.querySelector(".quantityCount")
                const addBtn = product.querySelector("#addCartBtn")
    
                let currentQuantity = parseInt(quantity.textContent)
    
                increaseBtn.addEventListener("click",()=>{
                    currentQuantity += 1
                    quantity.textContent = currentQuantity
                })
                
                decreaseBtn.addEventListener("click",()=>{
                    if(currentQuantity > 1){
                        currentQuantity -= 1
                        quantity.textContent = currentQuantity
                    }
                })
    
                addBtn.addEventListener("click",function(e){
                    e.preventDefault()
                    const prodId = this.dataset.productId;
                    
                    const csrfToken = document.cookie.split(';')
                        .find(cookie => cookie.trim().startsWith('csrftoken='))
                        ?.split('=')[1];
    
                    fetch(`/cart/add-to-cart/${prodId}/`,{
                        method : "POST",
                        headers : { 
                            'Content-Type' : 'application/json',
                            'X-CSRFToken' : csrfToken
                        },
                        body : JSON.stringify({
                            quantity : currentQuantity
                        })
                    })
                    .then(response => response.json())
                })
            })        
    
        </script>
        {% endblock %}